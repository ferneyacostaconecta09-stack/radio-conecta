<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Radio Conecta | M√°s que radio, somos tu compa√±√≠a</title>
  <link rel="stylesheet" href="css/estilos.css" />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
  <link rel="icon" href="img/logo/favicon.png" type="image/png">
</head>

<body>
  <!-- ===== HEADER ===== -->
  <header class="header">
    <div class="logo">
      <img src="img/logo/logo.png" alt="Radio Conecta Logo" />
    </div>

    <button id="btnVolver" class="btn-volver" aria-label="Volver al inicio">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="icon-back">
        <path stroke-linecap="round" stroke-linejoin="round" d="M10 19l-7-7m0 0l7-7m-7 7h18"/>
      </svg>
      <span>Volver</span>
    </button>
  </header>

  <!-- SECCI√ìN PRINCIPAL: RADIO EN VIVO -->
  <div id="pjax-container">
  <main class="radio-en-vivo">
    <div class="radio-bg-overlay">
      <section class="radio-container">
        <div class="radio-header">
          <h1 class="radio-title">
            <svg class="title-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8">
              <path stroke-linecap="round" stroke-linejoin="round" d="M3 18v-6a9 9 0 1 1 18 0v6"/>
              <path stroke-linecap="round" stroke-linejoin="round" d="M3 18a3 3 0 0 0 3 3h3v-6H6a3 3 0 0 0-3 3Zm18 0a3 3 0 0 1-3 3h-3v-6h3a3 3 0 0 1 3 3Z"/>
            </svg>
            <span>Radio Conecta</span> en Vivo
          </h1>
          <p class="radio-subtitle">Tu conexi√≥n 24/7 con la mejor m√∫sica y locutores incre√≠bles</p>
        </div>

        <!-- Reproductor Moderno (UI profesional, controla el reproductor global) -->
        <div class="radio-player" id="radio-player" role="region" aria-label="Reproductor en vivo Radio Conecta">
          <div class="rp-header">
            <div class="rp-left">
              <img class="rp-cover" src="img/logo/logo.png" alt="Radio Conecta" onerror="this.style.display='none'" />
              <div class="rp-info">
                <h3>Radio Conecta</h3>
                <div class="rp-live" aria-label="Transmisi√≥n en vivo"><span class="dot" aria-hidden="true"></span> En vivo</div>
              </div>
            </div>
          </div>

            <div class="rp-controls">
              <button class="rp-btn rp-play-toggle" aria-label="Reproducir" title="Reproducir (Space/K)">
                <img class="rp-icon rp-play" src="img/player/play.svg" alt="Play" aria-hidden="true" />
                <img class="rp-icon rp-pause" src="img/player/pause.svg" alt="Pausa" aria-hidden="true" />
              </button>
              <div class="rp-volume" aria-label="Control de volumen">
                <input type="range" class="rp-vol-slider" min="0" max="100" step="1" value="80" aria-label="Volumen" />
              </div>
              <button class="rp-btn rp-mute-toggle" aria-label="Silenciar" title="Silenciar (M)">
                <img class="rp-icon rp-mute-off" src="img/player/volume.svg" alt="Volumen" aria-hidden="true" />
                <svg class="rp-icon rp-mute-on" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 9v6m6-6v6M5 5l14 14"/></svg>
              </button>
              <p class="ios-volume-note" style="display:none; font-size: 11px; color: rgba(255,255,255,0.6); margin: 8px 0 0; text-align: center;">
                üì± En iOS usa los botones de volumen del dispositivo
              </p>
            </div>

          <!-- Efecto visual animado (no sincronizado con el audio) -->
          <div class="visual-eq" aria-hidden="true">
            <span></span><span></span><span></span><span></span>
            <span></span><span></span><span></span><span></span>
            <span></span><span></span><span></span><span></span>
            <span></span><span></span><span></span><span></span>
          </div>
        </div>

        <p class="now-playing">
          <svg class="np-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6">
            <path stroke-linecap="round" stroke-linejoin="round" d="M4 5h12a2 2 0 0 1 2 2v9a3 3 0 0 1-3 3H7a3 3 0 0 1-3-3V5Z"/>
            <path stroke-linecap="round" stroke-linejoin="round" d="M8 9h5m-5 3h8M7 3h6"/>
          </svg>
          Transmitiendo en directo desde los estudios de <strong>Radio Conecta</strong>
        </p>
      </section>
    </div>
  </main>
  </div>

  <!-- ===== FOOTER ===== -->
  <footer class="footer-radio">
    <p>&copy; 2025 <strong>Radio Conecta</strong> - M√°s que radio, somos tu compa√±√≠a</p>
    <p class="version">v1.0.2 ‚Ä¢ 08/11/2025</p>
  </footer>

  <script src="js/player.js"></script>
  <script src="js/main.js"></script>
  
  <!-- Script de auto-inicio y debug para el reproductor dedicado + accesibilidad y atajos -->
  <script>
    // Detectar iOS y mostrar nota sobre control de volumen
    const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent) || 
                  (navigator.platform === 'MacIntel' && navigator.maxTouchPoints > 1);
    if (isIOS) {
      const note = document.querySelector('.ios-volume-note');
      if (note) note.style.display = 'block';
    }
    
    // Identificar esta pesta√±a como radio.html
    if (!window.name || !window.name.startsWith('rc-radio-')) {
      window.name = 'rc-radio-' + Date.now();
    }
    
    // Canal de comunicaci√≥n entre pesta√±as
    const bc = new BroadcastChannel('radio-conecta-tabs');
    
    // Responder a solicitudes de enfoque
    bc.onmessage = (e) => {
      if (e.data.type === 'find-radio' && e.data.requestId) {
        bc.postMessage({ type: 'radio-found', requestId: e.data.requestId, tabName: window.name });
        window.focus();
      }
    };
    
    // Detener la m√∫sica cuando se cierre la pesta√±a
    window.addEventListener('beforeunload', () => {
      if (window.RadioPlayer && window.RadioPlayer.audio) {
        console.log('üõë Pesta√±a cerr√°ndose - deteniendo todo...');
        
        // Marcar como pausado manualmente para evitar auto-resume
        window.RadioPlayer.pause();
        
        // Limpiar el audio completamente
        const audio = window.RadioPlayer.audio;
        audio.pause();
        audio.removeAttribute('src');
        audio.src = '';
        audio.load();
        
        // Limpiar sessionStorage para que no intente reanudar
        try {
          sessionStorage.removeItem('rc_was_playing');
        } catch(_) {}
        
        console.log('‚úÖ Audio completamente detenido');
      }
    });
    
    // Tambi√©n detener cuando la pesta√±a pierde visibilidad (por si beforeunload no se dispara)
    document.addEventListener('visibilitychange', () => {
      if (document.visibilityState === 'hidden' && window.RadioPlayer) {
        // Solo marcar como no reproduciendo en sessionStorage
        try {
          sessionStorage.setItem('rc_was_playing', '0');
        } catch(_) {}
      }
    });
    
    // Bot√≥n Volver: navegar a index.html en la misma pesta√±a
    document.getElementById('btnVolver').addEventListener('click', () => {
      window.location.href = 'index.html';
    });
    
    console.log('üìª Script inline del reproductor ejecut√°ndose...');
    
    // Esperar a que RadioPlayer est√© listo
    document.addEventListener('DOMContentLoaded', () => {
      console.log('üéµ DOMContentLoaded - P√°gina de reproductor cargada');
      console.log('RadioPlayer disponible:', !!window.RadioPlayer);
      console.log('Audio disponible:', !!(window.RadioPlayer && window.RadioPlayer.audio));
      
      // Verificar botones
      const playBtn = document.querySelector('.rp-play-toggle');
      const volSlider = document.querySelector('.rp-vol-slider');
      console.log('Bot√≥n play encontrado:', !!playBtn);
      console.log('Slider volumen encontrado:', !!volSlider);
      
      // Peque√±o delay para asegurar que todo est√© inicializado
      // Atajos de teclado (solo en esta pesta√±a)
      window.addEventListener('keydown', (ev) => {
        if (!window.RadioPlayer) return;
        // Evitar interferir con inputs
        if (['INPUT','TEXTAREA'].includes(ev.target.tagName)) return;
        // Barra espaciadora o K: toggle
        if (ev.code === 'Space' || ev.key.toLowerCase() === 'k') {
          ev.preventDefault();
          window.RadioPlayer.toggle();
        }
        // M: mute
        if (ev.key.toLowerCase() === 'm') {
          ev.preventDefault();
          window.RadioPlayer.toggleMute();
          updateMuteIcon();
        }
        // Flechas volumen
        if (ev.key === 'ArrowUp') {
          ev.preventDefault();
          window.RadioPlayer.setVolume(Math.min(1, window.RadioPlayer.audio.volume + 0.05));
        }
        if (ev.key === 'ArrowDown') {
          ev.preventDefault();
          window.RadioPlayer.setVolume(Math.max(0, window.RadioPlayer.audio.volume - 0.05));
        }
      });

      function updateMuteIcon(){
        const muteBtn = document.querySelector('.rp-mute-toggle');
        if (!muteBtn || !window.RadioPlayer) return;
        const isMuted = window.RadioPlayer.audio.volume === 0;
        muteBtn.setAttribute('aria-label', isMuted ? 'Restaurar volumen' : 'Silenciar');
        muteBtn.title = isMuted ? 'Restaurar volumen (M)' : 'Silenciar (M)';
        muteBtn.classList.toggle('muted', isMuted);
      }

      // Diagn√≥stico del stream
      if (window.RadioPlayer && window.RadioPlayer.audio) {
        const audio = window.RadioPlayer.audio;
        
        // Listeners de diagn√≥stico
        audio.addEventListener('loadstart', () => console.log('üì• Cargando stream...'));
        audio.addEventListener('loadedmetadata', () => console.log('‚úÖ Metadata cargada'));
        audio.addEventListener('loadeddata', () => console.log('‚úÖ Datos cargados'));
        audio.addEventListener('canplay', () => console.log('‚úÖ Puede reproducir'));
        audio.addEventListener('canplaythrough', () => console.log('‚úÖ Puede reproducir completamente'));
        audio.addEventListener('playing', () => console.log('‚ñ∂Ô∏è Reproduciendo'));
        audio.addEventListener('waiting', () => console.log('‚è≥ Esperando datos...'));
        audio.addEventListener('stalled', () => console.log('‚ö†Ô∏è Stream detenido'));
        audio.addEventListener('error', (e) => {
          console.error('‚ùå Error de audio:', {
            error: audio.error,
            code: audio.error?.code,
            message: audio.error?.message,
            src: audio.src,
            networkState: audio.networkState,
            readyState: audio.readyState
          });
        });
      }
      
      setTimeout(() => {
        if (window.RadioPlayer && window.RadioPlayer.audio) {
          console.log('‚ñ∂Ô∏è Intentando iniciar reproducci√≥n autom√°tica...');
          console.log('Estado actual del audio:', {
            paused: window.RadioPlayer.audio.paused,
            readyState: window.RadioPlayer.audio.readyState,
            networkState: window.RadioPlayer.audio.networkState,
            src: window.RadioPlayer.audio.src,
            currentTime: window.RadioPlayer.audio.currentTime
          });
          
          // Intentar reproducir autom√°ticamente (algunos navegadores lo permiten en ventanas nuevas abiertas por el usuario)
          window.RadioPlayer.play().then(() => {
            console.log('‚úÖ Reproducci√≥n iniciada correctamente');
          }).catch(err => {
            console.log('‚è∏Ô∏è Autoplay bloqueado por el navegador:', err.message);
            console.log('üëÜ El usuario debe hacer clic en Play para iniciar.');
            console.log('Nombre del error:', err.name);
          });
          updateMuteIcon();
          window.RadioPlayer.audio.addEventListener('volumechange', updateMuteIcon);
        } else {
          console.error('‚ùå RadioPlayer no est√° disponible');
        }
      }, 800);
    });
  </script>
  <script src="js/player.js"></script>
  <script src="js/main.js"></script>
</body>

</html>
